<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Fpu (interval_intel.Interval_intel__.Fpu)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">interval_intel</a> &#x00BB; <a href="../index.html">Interval_intel__</a> &#x00BB; Fpu</nav><h1>Module <code>Interval_intel__.Fpu</code></h1><nav class="toc"><ul><li><a href="#rounding-down-and-up-standard-functions">Rounding down and up standard functions</a></li><li><a href="#improving-standard-functions">Improving standard functions</a></li><li><a href="#overriding-standard-functions">Overriding standard functions</a></li></ul></nav></header><aside><p>Access to low level floating point functions. THIS LIBRARY ONLY WORKS FOR INTEL PROCESSORS.</p><p>Every function, say cos, come in three flavors:</p><ul><li><code>fcos</code> which is an implementation of cos that is correct (contrary to the standard functions, see below) and which result lies inside the interval defined by the following two funtions.</li><li><code>Low.cos</code> a lower bound on the (true) value of cos.</li><li><code>High.cos</code> an upper bound on the (true) value of cos.</li></ul><p>Almost all low level functions are implemented using the x87 functions and x87 rounding modes. There are unfortunately a few problems to understand. The x87 is supposed to be able to return a nearest value and a upper and a lower bound for each elementary operation it can perform. This is not always true. Some functions such as cos(), sin() or tan() are not properly implemented everywhere.</p><p>For example, for the angle a= 1.570 796 326 794 896 557 998 981 734 272 092 580 795 288 085 937 5 the following values are computed for cos(a), by (1) the MPFI library (with 128 bits precision), (2) the x87 in low mode, (3) the x87 in nearest mode (default value for the C and OCaml library on 32 bits linux), (4) the x87 in high mode, (5) the SSE2 implementation (default value for the C and OCaml library on 64 bits linux):</p><p>(1) 6.123 233 995 736 765 886 130 329 661 375 001 464 640 377 798 836e-17</p><p>(2) 6.123 031 769 111 885 058 461 925 285 082 049 859 451 216 355 021e-17</p><p>(3) 6.123 031 769 111 886 291 057 089 692 912 995 815 277 099 609 375e-17</p><p>(4) 6.123 031 769 111 886 291 057 089 692 912 995 815 277 099 609 375e-17</p><p>(5) 6.123 233 995 736 766 035 868 820 147 291 983 023 128 460 623 387e-17</p><p>The upper bound (4) computed by the x87 is clearly incorrect, as it is lower than the correct value computed by the MPFI library.</p><p>The value computed by the SSE2 (5) is much more precise than the one computed by the x87. Unfortunately, there is no way to get an upper and lower bound value, and we are thus stuck with the x87 for computing these (sometimes incorrect) bounds.</p><p>The problem here is that the value computed by the standard, C-lib (or OCaml) cos function doesn't always lie in the lower/upper bound interval returned by the x87 functions, and this can be a very serious problem when executing Branch and Bound algorithms which expect the mid-value to be inside the lower/upper interval.</p><p>We solved the problem by rewritting the trigonometric functions in order to make them both consistant and correct. We used the following property: when -pi/4&lt;=a&lt;=pi/4 the rounding in 64 bits of the 80 bits low/std/high value returned by the x87 are correct. Moreover, when 0&lt;a&lt;2**53 then (a mod (2Pi_low)) and (a mod (2Pi_high)) are in the same quadrant. Last, (a mod Pi/2_High) &lt;= (a mod Pi/2) &lt;= (a mod Pi/2_Low). With this implementation, the lower and upper bounds are properly set and they are always lower (resp. higher) than the value computed by the standard cos functions on 32 and 64 bits architecture. This rewritting has been done in assembly language and is quite efficient.</p><p>Keep in mind that values returned by the standard (C-lib or OCaml) cos(), sin() or tan() functions are still different on 32 and 64 bits architecture. If you want to have a program which behaves exactly in the same way on both architectures, you can use the <code>Fpu</code> module <code>fcos</code>, <code>fsin</code> or <code>ftan</code> functions which always return the same values on all architectures, or even use the <code>Fpu_rename</code> or <code>Fpu_rename_all</code> modules to transparently rename the floating point functions.</p><p>The functions are quite efficient (see below). However, they have a serious disadvantage compared to their standard counterparts. When the compiler compiles instruction ''a+.b'', the code of the operation is inlined, while when it compiles ''(fadd a b)'', the compiler generates a function call, which is expensive.</p><p>Intel Atom 230 Linux 32 bits</p><ul><li>tan speed (10000000 calls):2.380149</li><li>ftan speed (10000000 calls):2.528158</li><li>cos speed (10000000 calls):1.804113</li><li>fcos speed (10000000 calls):2.076129</li><li>sin speed (10000000 calls):1.844116</li><li>fsin speed (10000000 calls):1.972123</li><li>+. speed (10000000 calls):0.604037</li><li>fadd speed (10000000 calls):0.980062</li><li>-. speed (10000000 calls):0.644040</li><li>fsub speed (10000000 calls):0.980061</li><li>*. speed (10000000 calls):0.604038</li><li>fmul speed (10000000 calls):0.980061</li><li>/. speed (10000000 calls):0.992062</li><li>fdiv speed (10000000 calls):1.424089</li><li>** speed (10000000 calls):15.420964</li><li>pow speed (10000000 calls):4.528283</li><li>mod_float speed (10000000 calls):1.996125</li><li>fmod speed (10000000 calls):1.236077</li></ul><p>Intel 980X Linux 64 bits</p><ul><li>tan speed (10000000 calls):0.896056</li><li>ftan speed (10000000 calls):0.472029</li><li>cos speed (10000000 calls):0.520033</li><li>fcos speed (10000000 calls):0.400025</li><li>sin speed (10000000 calls):0.524033</li><li>fsin speed (10000000 calls):0.400025</li><li>+. speed (10000000 calls):0.068005</li><li>fadd speed (10000000 calls):0.124008</li><li>-. speed (10000000 calls):0.068004</li><li>fsub speed (10000000 calls):0.120008</li><li>*. speed (10000000 calls):0.068004</li><li>fmul speed (10000000 calls):0.128008</li><li>/. speed (10000000 calls):0.096006</li><li>fdiv speed (10000000 calls):0.156010</li><li>** speed (10000000 calls):0.668041</li><li>pow speed (10000000 calls):1.028064</li><li>mod_float speed (10000000 calls):0.224014</li><li>fmod speed (10000000 calls):0.152010</li></ul></aside><section><header><h3 id="rounding-down-and-up-standard-functions"><a href="#rounding-down-and-up-standard-functions" class="anchor"></a>Rounding down and up standard functions</h3><p>The following sub-modules <a href="Low/index.html"><code>Low</code></a> and <a href="High/index.html"><code>High</code></a> implement the same functions but with different roundings (down for <a href="Low/index.html"><code>Low</code></a> and up for <a href="High/index.html"><code>High</code></a>).</p></header><dl><dt class="spec module" id="module-Low"><a href="#module-Low" class="anchor"></a><code><span class="keyword">module</span> <a href="Low/index.html">Low</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Functions rounding down their results.</p></dd></dl><dl><dt class="spec module" id="module-High"><a href="#module-High" class="anchor"></a><code><span class="keyword">module</span> <a href="High/index.html">High</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Functions rounding up their results.</p></dd></dl></section><section><header><h3 id="improving-standard-functions"><a href="#improving-standard-functions" class="anchor"></a>Improving standard functions</h3></header><dl><dt class="spec value" id="val-ffloat"><a href="#val-ffloat" class="anchor"></a><code><span class="keyword">val</span> ffloat : int <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-ffloat_high"><a href="#val-ffloat_high" class="anchor"></a><code><span class="keyword">val</span> ffloat_high : int <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-ffloat_low"><a href="#val-ffloat_low" class="anchor"></a><code><span class="keyword">val</span> ffloat_low : int <span>&#45;&gt;</span> float</code></dt><dd><p>float() functions. The float function is exact on 32 bits machine but not on 64 bits machine with ints larger than 53 bits</p></dd></dl><dl><dt class="spec value" id="val-fadd"><a href="#val-fadd" class="anchor"></a><code><span class="keyword">val</span> fadd : float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fadd_low"><a href="#val-fadd_low" class="anchor"></a><code><span class="keyword">val</span> fadd_low : float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fadd_high"><a href="#val-fadd_high" class="anchor"></a><code><span class="keyword">val</span> fadd_high : float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> float</code></dt><dd><p>Floating point addition in nearest, low and high mode</p></dd></dl><dl><dt class="spec value" id="val-fsub"><a href="#val-fsub" class="anchor"></a><code><span class="keyword">val</span> fsub : float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fsub_low"><a href="#val-fsub_low" class="anchor"></a><code><span class="keyword">val</span> fsub_low : float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fsub_high"><a href="#val-fsub_high" class="anchor"></a><code><span class="keyword">val</span> fsub_high : float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> float</code></dt><dd><p>Floating point substraction in nearest, low and high mode</p></dd></dl><dl><dt class="spec value" id="val-fmul"><a href="#val-fmul" class="anchor"></a><code><span class="keyword">val</span> fmul : float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fmul_low"><a href="#val-fmul_low" class="anchor"></a><code><span class="keyword">val</span> fmul_low : float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fmul_high"><a href="#val-fmul_high" class="anchor"></a><code><span class="keyword">val</span> fmul_high : float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> float</code></dt><dd><p>Floating point multiplication in nearest, low and high mode</p></dd></dl><dl><dt class="spec value" id="val-fdiv"><a href="#val-fdiv" class="anchor"></a><code><span class="keyword">val</span> fdiv : float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fdiv_low"><a href="#val-fdiv_low" class="anchor"></a><code><span class="keyword">val</span> fdiv_low : float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fdiv_high"><a href="#val-fdiv_high" class="anchor"></a><code><span class="keyword">val</span> fdiv_high : float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> float</code></dt><dd><p>Floating point division in nearest, low and high mode</p></dd></dl><dl><dt class="spec value" id="val-fmod"><a href="#val-fmod" class="anchor"></a><code><span class="keyword">val</span> fmod : float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> float</code></dt><dd><p>Modulo (result is supposed to be exact)</p></dd></dl><dl><dt class="spec value" id="val-fsqrt"><a href="#val-fsqrt" class="anchor"></a><code><span class="keyword">val</span> fsqrt : float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fsqrt_low"><a href="#val-fsqrt_low" class="anchor"></a><code><span class="keyword">val</span> fsqrt_low : float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fsqrt_high"><a href="#val-fsqrt_high" class="anchor"></a><code><span class="keyword">val</span> fsqrt_high : float <span>&#45;&gt;</span> float</code></dt><dd><p>Floating point square root in nearest, low and high mode</p></dd></dl><dl><dt class="spec value" id="val-fexp"><a href="#val-fexp" class="anchor"></a><code><span class="keyword">val</span> fexp : float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fexp_low"><a href="#val-fexp_low" class="anchor"></a><code><span class="keyword">val</span> fexp_low : float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fexp_high"><a href="#val-fexp_high" class="anchor"></a><code><span class="keyword">val</span> fexp_high : float <span>&#45;&gt;</span> float</code></dt><dd><p>Floating point exponential in nearest, low and high mode</p></dd></dl><dl><dt class="spec value" id="val-flog"><a href="#val-flog" class="anchor"></a><code><span class="keyword">val</span> flog : float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-flog_low"><a href="#val-flog_low" class="anchor"></a><code><span class="keyword">val</span> flog_low : float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-flog_high"><a href="#val-flog_high" class="anchor"></a><code><span class="keyword">val</span> flog_high : float <span>&#45;&gt;</span> float</code></dt><dd><p>Floating point log in nearest, low and high mode</p></dd></dl><dl><dt class="spec value" id="val-flog_pow"><a href="#val-flog_pow" class="anchor"></a><code><span class="keyword">val</span> flog_pow : float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-flog_pow_low"><a href="#val-flog_pow_low" class="anchor"></a><code><span class="keyword">val</span> flog_pow_low : float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-flog_pow_high"><a href="#val-flog_pow_high" class="anchor"></a><code><span class="keyword">val</span> flog_pow_high : float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> float</code></dt><dd><p>Computes x^y for 0 &lt; x &lt; infinity and neg_infinity &lt; y &lt; infinity</p></dd></dl><dl><dt class="spec value" id="val-fpow"><a href="#val-fpow" class="anchor"></a><code><span class="keyword">val</span> fpow : float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fpow_low"><a href="#val-fpow_low" class="anchor"></a><code><span class="keyword">val</span> fpow_low : float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fpow_high"><a href="#val-fpow_high" class="anchor"></a><code><span class="keyword">val</span> fpow_high : float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> float</code></dt><dd><p>Computes x^y expanded to its mathematical limit when it exists</p></dd></dl><dl><dt class="spec value" id="val-fsin"><a href="#val-fsin" class="anchor"></a><code><span class="keyword">val</span> fsin : float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fsin_low"><a href="#val-fsin_low" class="anchor"></a><code><span class="keyword">val</span> fsin_low : float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fsin_high"><a href="#val-fsin_high" class="anchor"></a><code><span class="keyword">val</span> fsin_high : float <span>&#45;&gt;</span> float</code></dt><dd><p>Computes sin(x) for x in ]-2^63, 2^63[</p></dd></dl><dl><dt class="spec value" id="val-fcos"><a href="#val-fcos" class="anchor"></a><code><span class="keyword">val</span> fcos : float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fcos_low"><a href="#val-fcos_low" class="anchor"></a><code><span class="keyword">val</span> fcos_low : float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fcos_high"><a href="#val-fcos_high" class="anchor"></a><code><span class="keyword">val</span> fcos_high : float <span>&#45;&gt;</span> float</code></dt><dd><p>Computes cos(x) for x in ]-2^63, 2^63[</p></dd></dl><dl><dt class="spec value" id="val-ftan"><a href="#val-ftan" class="anchor"></a><code><span class="keyword">val</span> ftan : float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-ftan_low"><a href="#val-ftan_low" class="anchor"></a><code><span class="keyword">val</span> ftan_low : float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-ftan_high"><a href="#val-ftan_high" class="anchor"></a><code><span class="keyword">val</span> ftan_high : float <span>&#45;&gt;</span> float</code></dt><dd><p>Computes tan(x) for x in ]-2^63, 2^63[</p></dd></dl><dl><dt class="spec value" id="val-fatan"><a href="#val-fatan" class="anchor"></a><code><span class="keyword">val</span> fatan : float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fatan_low"><a href="#val-fatan_low" class="anchor"></a><code><span class="keyword">val</span> fatan_low : float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fatan_high"><a href="#val-fatan_high" class="anchor"></a><code><span class="keyword">val</span> fatan_high : float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> float</code></dt><dd><p><code>fatan x y</code> computes <code>atan2 y x</code>.</p></dd></dl><dl><dt class="spec value" id="val-facos"><a href="#val-facos" class="anchor"></a><code><span class="keyword">val</span> facos : float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-facos_low"><a href="#val-facos_low" class="anchor"></a><code><span class="keyword">val</span> facos_low : float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-facos_high"><a href="#val-facos_high" class="anchor"></a><code><span class="keyword">val</span> facos_high : float <span>&#45;&gt;</span> float</code></dt><dd><p>arc-cosine functions</p></dd></dl><dl><dt class="spec value" id="val-fasin"><a href="#val-fasin" class="anchor"></a><code><span class="keyword">val</span> fasin : float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fasin_low"><a href="#val-fasin_low" class="anchor"></a><code><span class="keyword">val</span> fasin_low : float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fasin_high"><a href="#val-fasin_high" class="anchor"></a><code><span class="keyword">val</span> fasin_high : float <span>&#45;&gt;</span> float</code></dt><dd><p>arc-sinus functions</p></dd></dl><dl><dt class="spec value" id="val-fsinh"><a href="#val-fsinh" class="anchor"></a><code><span class="keyword">val</span> fsinh : float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fsinh_low"><a href="#val-fsinh_low" class="anchor"></a><code><span class="keyword">val</span> fsinh_low : float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fsinh_high"><a href="#val-fsinh_high" class="anchor"></a><code><span class="keyword">val</span> fsinh_high : float <span>&#45;&gt;</span> float</code></dt><dd><p>Computes sinh(x)</p></dd></dl><dl><dt class="spec value" id="val-fcosh"><a href="#val-fcosh" class="anchor"></a><code><span class="keyword">val</span> fcosh : float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fcosh_low"><a href="#val-fcosh_low" class="anchor"></a><code><span class="keyword">val</span> fcosh_low : float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-fcosh_high"><a href="#val-fcosh_high" class="anchor"></a><code><span class="keyword">val</span> fcosh_high : float <span>&#45;&gt;</span> float</code></dt><dd><p>Computes cosh(x)</p></dd></dl><dl><dt class="spec value" id="val-ftanh"><a href="#val-ftanh" class="anchor"></a><code><span class="keyword">val</span> ftanh : float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-ftanh_low"><a href="#val-ftanh_low" class="anchor"></a><code><span class="keyword">val</span> ftanh_low : float <span>&#45;&gt;</span> float</code></dt><dt class="spec value" id="val-ftanh_high"><a href="#val-ftanh_high" class="anchor"></a><code><span class="keyword">val</span> ftanh_high : float <span>&#45;&gt;</span> float</code></dt><dd><p>Computes tanh(x)</p></dd></dl><dl><dt class="spec value" id="val-is_neg"><a href="#val-is_neg" class="anchor"></a><code><span class="keyword">val</span> is_neg : float <span>&#45;&gt;</span> bool</code></dt><dd><p><code>is_neg x</code> returns if <code>x</code> has its sign bit set (true for <code>-0.</code>).</p></dd></dl></section><section><header><h3 id="overriding-standard-functions"><a href="#overriding-standard-functions" class="anchor"></a>Overriding standard functions</h3></header><dl><dt class="spec module" id="module-Rename"><a href="#module-Rename" class="anchor"></a><code><span class="keyword">module</span> <a href="Rename/index.html">Rename</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Aliases floating point functions to their &quot;constant&quot; counterparts, except for &quot;ordinary functions&quot;.</p></dd></dl><dl><dt class="spec module" id="module-Rename_all"><a href="#module-Rename_all" class="anchor"></a><code><span class="keyword">module</span> <a href="Rename_all/index.html">Rename_all</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Aliases floating point functions to their &quot;constant&quot; counterparts, including <code>+.</code>, <code>-.</code>, <code>*.</code> and <code>/.</code>.</p></dd></dl></section></div></body></html>